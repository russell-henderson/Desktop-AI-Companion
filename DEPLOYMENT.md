---
Version: 0.1.0
Last Updated: 2025-11-19
Status: Draft
Owner: Desktop AI Companion Team
---

# DEPLOYMENT.md

This document explains how to install, package, and deploy Desktop AI Companion on Windows. It covers local development, creating installers, installing on other machines, and handling data storage and updates.

The app is Windows only for this MVP and uses:

- Electron for the desktop shell
- React plus TypeScript and Vite for the renderer
- SQLite via sql.js in the main process
- OpenAI models behind a secure IPC layer

---

## 1. Environments

### 1.1 Development environment

Recommended for contributors and debugging.

- Operating system  
  - Windows 10 or Windows 11
- Runtime  
  - Node.js 18 or later  
  - npm 8 or later
- Tools  
  - Git  
  - PowerShell (included with modern Windows)
- OpenAI  
  - Valid OpenAI API key

### 1.2 Runtime environment (end user)

For machines that will only install and run the packaged app.

- Operating system  
  - Windows 10 or Windows 11, 64 bit
- Hardware  
  - At least 8 GB of RAM recommended  
  - Sufficient disk space for the installer and the app data folder
- Network  
  - Internet access for OpenAI calls  
  - Optional offline usage for UI and historical data, but AI features require connectivity

No Node or npm is required on end user machines. They only need the installer.

---

## 2. Configuration

### 2.1 Environment variables

The main process reads sensitive configuration such as the OpenAI key from environment variables. Store them in a `.env` file at the project root during development.

**Important:** `OPENAI_API_KEY` is **required**. The app will fail to start with an error if this variable is missing.

Example `.env`:

```ini
OPENAI_API_KEY=your-openai-key-here

# Optional variables
OPENAI_MODEL=gpt-5-nano-2025-08-07
# LOG_LEVEL=info
# DATABASE_PATH=auto (for sql.js this is managed by the app)
```

Guidelines:

- Never commit a `.env` file that contains real secrets.
- `.gitignore` already ignores `.env` and related files.
- The renderer does not read any secrets. The main process owns the OpenAI key and any other private values.
- `OPENAI_MODEL` is optional and defaults to `gpt-3.5-turbo` if not specified.

### 2.2 OpenAI configuration

The `AIService` in the main process:

- Reads `OPENAI_API_KEY` from environment (required).
- Reads `OPENAI_MODEL` from environment (optional, defaults to `gpt-3.5-turbo`).
- Creates a client instance for OpenAI.
- Uses that client for all chat completions.

If `OPENAI_API_KEY` is missing:

- The app will **fail to start** with an error: `Missing required environment variable: OPENAI_API_KEY`.
- You must set `OPENAI_API_KEY` before the app can launch.

If `OPENAI_API_KEY` is invalid or AI requests fail:

- The app will start successfully.
- AI requests will fail with a clear error message in chat and in logs.

---

## 3. Development workflow

### 3.1 Install dependencies

After cloning the repository:

```bash
git clone <your-repo-url>.git
cd Desktop-AI-Companion
npm install
```

Verify `node_modules` is created and no critical errors appear.

### 3.2 Run in development mode

Start the app with hot reload for the renderer:

```bash
npm run dev
```

This should:

- Start the Vite dev server for the renderer on port **3000**.
- Wait for the dev server to be ready, then compile the main process TypeScript.
- Launch Electron and load the Vite dev URL (`http://localhost:3000`).
- Open a desktop window with:

  - Sidebar
  - Top bar
  - Dashboard cards
  - Chat panel

Use this mode while developing UI, IPC, or services. The renderer will hot-reload when you make changes to React components.

### 3.3 Run tests and linting

Run unit tests:

```bash
npm test
```

Run linter (if configured in `package.json`):

```bash
npm run lint
```

Both commands should pass before you create a release build.

---

## 4. Building and packaging

### 4.1 Build the app

The main build command:

```bash
npm run build
```

This is expected to:

1. Run TypeScript checks.
2. Build the renderer bundle with Vite.
3. Invoke electron builder to create a packaged app and Windows installer.

If the build completes successfully, you should see:

- Vite build summary showing bundle size.
- Electron builder output describing the installer that was created.
- No TypeScript errors.

Warnings about icons or signing can be addressed later by adjusting the electron builder configuration.

### 4.2 Build artifacts

After `npm run build`:

- TypeScript compilation for the main process outputs to `dist-electron/`.
- The renderer bundle is generated by Vite in the `build/` directory.
- Electron builder creates the final packaged app and installer in the `dist/` directory:

  - `Desktop AI Companion Setup <version>.exe`
  - Additional files depending on your builder settings.

The build process:

1. Compiles main process TypeScript to `dist-electron/`
2. Builds renderer with Vite to `build/`
3. Packages everything with electron-builder to `dist/`

Review the electron builder configuration in `package.json` to confirm the exact output locations. There is no separate `electron-builder.yml` file; all configuration is in `package.json`.

---

## 5. Installing on other machines

### 5.1 Preparing the installer

From your development machine:

1. Ensure `npm run build` has completed successfully.
2. Locate the `.exe` installer created by electron builder under `dist` or the configured output directory.
3. Copy that installer to the target machine using:

   - Network share
   - USB drive
   - Secure file transfer

### 5.2 Installing the app

On the target machine:

1. Double click the installer executable.
2. Follow the installation prompts.
3. After installation:

   - Launch the app from the Start menu or desktop shortcut.
   - On first run, the app will create its own data folder under the user profile.

If the app needs an OpenAI key on that machine:

**Important:** `OPENAI_API_KEY` is **required** for the app to start. The app will fail to launch if this environment variable is not set.

You can provide it by one of these methods:

- Add `OPENAI_API_KEY` to the system environment variables and restart the app.
- Or use a local configuration facility if implemented later (for example an in app settings page that writes to a config file). For now, use environment variables.

**Note:** The app will display an error and exit if `OPENAI_API_KEY` is missing when it tries to start.

### 5.3 First run checks on a new machine

Once installed:

1. Launch the app and confirm:

   - Sidebar and dashboard appear without errors.
   - No fatal error banners appear.
2. Test a simple chat question.
3. Create a project and a notebook entry.
4. Run one toolbox tool (for example Process Inspector).
5. Confirm:

   - Notifications can appear if you trigger monitoring conditions.
   - Closing and reopening the app preserves data.

---

## 6. Data locations and backup

### 6.1 App data location

The app stores its data in a folder under the user profile. The exact path is determined by Electron's `app.getPath("userData")`, which uses the `name` field from `package.json` (not `productName`).

A typical path is:

```text
C:\Users\<username>\AppData\Roaming\electron-openai-desktop-assistant\
```

**Note:** The folder name comes from `package.json` `name: "electron-openai-desktop-assistant"`, while the display name comes from `productName: "Desktop AI Companion"`.

Inside this folder you should expect:

- `desktop-ai-companion.sqlite` - The SQLite database file (stored directly in the userData folder, not in a subfolder).
- Logs (if configured).
- Any other local configuration files.

The database file is created automatically on first run at: `{userData}/desktop-ai-companion.sqlite`

### 6.2 Backing up data

To back up user data:

1. Exit the app completely.
2. Copy the database file:

   - `C:\Users\<username>\AppData\Roaming\electron-openai-desktop-assistant\desktop-ai-companion.sqlite`
   - Or copy the entire folder: `C:\Users\<username>\AppData\Roaming\electron-openai-desktop-assistant\`
3. Store the copy in a secure backup location.

To restore:

1. Exit the app.
2. Replace the app data folder with the backup copy.
3. Start the app again.

Backups are especially useful before you install a new version or make changes to the schema.

---

## 7. Updating the app

### 7.1 In place updates

For manual deployment:

- Build a new version with `npm run build`.
- Distribute the new installer.
- End users can run the new installer which should:

  - Replace the previous version of the app.
  - Keep the existing app data folder with projects, chats, notebook entries, tool reports, and notifications.

Before shipping an update:

1. Confirm database schema has not changed in an incompatible way.
2. If schema changes are introduced, add migration logic before the app tries to query the database.

### 7.2 Versioning and changelog

Each release should:

1. Update `CHANGELOG.md` with:

   - Version number
   - Date
   - Summary of changes
2. Update `package.json` version field.
3. Optionally tag the release in Git.

Example tag:

```bash
git tag v0.1.0
git push origin v0.1.0
```

---

## 8. Security and permissions

### 8.1 System tools and privileges

The Toolbox and monitoring rely on:

- PowerShell commands for process inspection.
- Windows event log access for EventLogTriage.
- Network utilities for connectivity checks.

On some systems:

- You may need to run the app with higher privileges to read certain logs or system data.
- If access is denied, the tools should show friendly error messages and suggest running the app as administrator.

The app does not attempt to modify system settings automatically. Actions like ending processes are always explicit user choices and require confirmation.

### 8.2 OpenAI key handling

Deployment rules:

- Never hardcode API keys in source files.
- Use environment variables or OS secrets storage.
- If distributing installers, ensure the build does not embed development keys.

You can use different keys for development and production by setting them in each environment before running `npm run dev` or `npm run build`.

---

## 9. Troubleshooting

### 9.1 Common build issues

- `npm install` fails

  - Check Node.js version.
  - Delete `node_modules` and `package-lock.json` if necessary, then run `npm install` again.

- `npm run build` fails on TypeScript errors

  - Open the error in your editor.
  - Fix type mismatches and rerun.

- Electron builder errors about icons or descriptions

  - Update `package.json` with:

    - `productName` (display name)
    - `name` (used for userData folder path)
    - `appId` (if specified)
    - `description`
    - Icon file path
  - All electron-builder configuration is in `package.json`; there is no separate `electron-builder.yml` file.

### 9.2 Runtime issues

- App opens to a blank white screen

  - Launch with dev tools to inspect renderer errors.
  - Check that the preload script is being loaded and IPC is available.

- Chat fails with AI errors

  - Check `OPENAI_API_KEY` in the environment (required for app to start).
  - If the app won't start, verify `OPENAI_API_KEY` is set correctly.
  - Confirm internet access.
  - Look for logs from `AIService` if logging is enabled.

- Toolbox tools fail

  - Confirm that PowerShell is available.
  - Check that the user has permission to read event logs.
  - Run the app as administrator and retry if needed.

- Monitoring or notifications seem inactive

  - Give the app time for the monitoring interval to pass.
  - Force high CPU or memory load to trigger a notification.
  - Check logs from `MonitoringService`.

---

## 10. Release checklist

Before you share a build with others:

1. `npm install`
2. `npm test`
3. `npm run lint` (if configured)
4. `npm run build` (creates installer in `dist/` directory)
5. Locate the installer: `dist/Desktop AI Companion Setup <version>.exe`
6. Install the generated installer on a clean test machine or VM.
7. Run through quick smoke tests:

   - Open app and confirm UI loads.
   - Send at least one chat message.
   - Create a project and a notebook entry.
   - Run at least one toolbox tool.
   - Verify a notification can appear or the history view loads.
8. Update:

   - `CHANGELOG.md`
   - `README.md` if any visible behavior changed.
   - `TESTING_RESULTS.md` with the latest validation notes.

If all steps pass, the build is considered ready for internal or limited external use.
